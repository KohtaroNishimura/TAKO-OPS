{% extends "base.html" %}
{% block content %}
<div class="card rounded-2xl border border-slate-200 bg-white p-4 sm:p-6 shadow-sm">
  <h2 class="text-lg font-semibold text-slate-900">棚卸結果</h2>

  <p>
    <b>{{ st.scope }}</b> / <b>{{ st.location }}</b><br>
    日時：{{ st.taken_at }}<br>
    メモ：{{ st.note or "-" }}
  </p>

  <hr class="my-4 border-slate-200">

  <h3 class="text-base font-semibold text-slate-900">ADJUST反映（差分だけ）</h3>
  <div class="overflow-x-auto -mx-4 sm:mx-0">
    <table class="min-w-[640px] w-full text-sm">
    <thead>
      <tr>
        <th>材料</th>
        <th>単位</th>
        <th>差分（qty_delta）</th>
      </tr>
    </thead>
    <tbody>
      {% for a in adjusts %}
        <tr>
          <td>{{ a["name"] }}</td>
          <td>{{ a["unit_base"] }}</td>
          <td>{{ "%.2f"|format(a["qty_delta"]) }}</td>
        </tr>
      {% else %}
        <tr><td colspan="3">差分はありません（全て一致）</td></tr>
      {% endfor %}
    </tbody>
  </table>
  </div>

  <hr class="my-4 border-slate-200">

  <h3 class="text-base font-semibold text-slate-900">棚卸入力（counted）</h3>
  <div class="overflow-x-auto -mx-4 sm:mx-0">
    <table class="min-w-[640px] w-full text-sm">
    <thead>
      <tr>
        <th>材料</th>
        <th>単位</th>
        <th>棚卸数量</th>
      </tr>
    </thead>
    <tbody>
      {% for r in lines %}
        <tr>
          <td>{{ r["name"] }}</td>
          <td>{{ r["unit_base"] }}</td>
          <td>{{ "%.2f"|format(r["counted_qty"]) }}</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  </div>

  <div class="actions mt-4 flex flex-wrap items-center gap-2">
    <a class="btn inline-flex items-center justify-center rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-slate-800 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400" href="{{ url_for('stocktake_monthly_new') }}">次の棚卸を入力</a>
    <a class="button-link" href="{{ url_for('stocktake_edit_form', stocktake_id=st['stocktake_id']) }}">編集</a>
    <form method="post" action="{{ url_for('stocktake_delete', stocktake_id=st['stocktake_id']) }}" onsubmit="return confirm('棚卸を削除します。よろしいですか？');">
      <button type="submit" class="button-link text-red-600">削除</button>
    </form>
  </div>
</div>
{% endblock %}
