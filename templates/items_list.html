{% extends "base.html" %}
{% block content %}
  <div class="card rounded-2xl border border-slate-200 bg-white p-4 sm:p-6 shadow-sm">
    <h2 class="text-lg font-semibold text-slate-900">材料一覧</h2>
    <p class="muted">今は「材料の登録・編集」まで。のちほど仕入れ・棚卸・在庫計算に繋げます。</p>

    <div class="actions mt-4 flex flex-wrap items-center gap-2">
      <a class="btn inline-flex items-center justify-center rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-slate-800 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400" href="{{ url_for('item_new_form') }}">＋ 新規登録</a>
    </div>

    <div class="overflow-x-auto -mx-4 sm:mx-0">

      <table class="min-w-[640px] w-full text-sm">
      <thead>
        <tr>
          <th>ID</th>
          <th>材料名</th>
          <th>単位</th>
          <th>発注目安</th>
          <th>参考価格</th>
          <th>メモ</th>
          <th>原価区分</th>
          <th>固定（本部指定）</th>
          <th>仕入れ先</th>
          <th>有効</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for i in items %}
          <tr>
            <td>{{ i["item_id"] }}</td>
            <td>{{ i["name"] }}</td>
            <td>{{ i["unit_base"] }}</td>
            <td>{{ "%.2f"|format(i["reorder_point"]) }}</td>
            <td>{{ "%.2f"|format(i["ref_unit_price"]) }}</td>
            <td>{{ i["note"] or "" }}</td>
            <td>{{ "食材" if i["cost_group"]=="FOOD" else "消耗品" }}</td>
            <td>{{ "✓" if i["is_fixed"] else "" }}</td>
            <td>{{ i["supplier_name"] or "" }}</td>
            <td>{{ "◯" if i["is_active"] else "" }}</td>
            <td class="whitespace-nowrap">
              <a class="button-link inline-flex items-center rounded-lg border border-slate-200 px-2 py-1 text-xs font-semibold text-slate-700 hover:bg-slate-50" href="{{ url_for('item_edit_form', item_id=i['item_id']) }}">編集</a>

              <form method="post"
                    action="{{ url_for('item_delete', item_id=i['item_id']) }}"
                    class="inline"
                    onsubmit="return confirm('この材料を削除しますか？（関連データがある場合は無効化になります）');">
                <button type="submit" class="inline-flex items-center rounded-lg border border-slate-200 px-2 py-1 text-xs font-semibold text-slate-700 hover:bg-slate-50">削除</button>
              </form>
            </td>
          </tr>
        {% else %}
          <tr><td colspan="11">まだ材料がありません。「新規登録」から追加してください。</td></tr>
        {% endfor %}
      </tbody>
    </table>
    </div>
  </div>
{% endblock %}
