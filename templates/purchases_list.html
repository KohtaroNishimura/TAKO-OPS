{% extends "base.html" %}
{% block content %}
  {% if created_purchase_id %}
    <div class="card" style="margin-bottom:12px;">
      <b>入庫登録しました。</b>
      <div class="actions" style="margin-top:8px;">
        <a class="btn" href="{{ url_for('transfer_new_from_purchase', purchase_id=created_purchase_id) }}">
          この仕入れを店舗へ移動
        </a>
      </div>
    </div>
  {% endif %}

  <div class="card">
    <h2>入庫（仕入れ）一覧</h2>

    <div class="actions">
      <a class="btn" href="{{ url_for('purchase_new_form') }}">＋ 入庫登録</a>
    </div>

    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>日時</th>
          <th>仕入れ先</th>
          <th>場所</th>
          <th>合計金額</th>
          <th>メモ</th>
          <th></th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        {% for p in purchases %}
          <tr>
            <td><a href="{{ url_for('purchase_detail', purchase_id=p['purchase_id']) }}">{{ p["purchase_id"] }}</a></td>
            <td>{{ p["purchased_at"][:10] if p["purchased_at"] else "" }}</td>
            <td>{{ p["supplier_name"] or "" }}</td>
            <td>{{ p["location"] or "" }}</td>
            <td>{{ "%.0f"|format(p["total_amount"] or 0) }}</td>
            <td>{{ p["note"] or "" }}</td>
            <td style="white-space: nowrap;">
              <a class="button-link" href="{{ url_for('purchase_edit_form', purchase_id=p['purchase_id']) }}">編集</a>

              <form method="post"
                    action="{{ url_for('purchase_delete', purchase_id=p['purchase_id']) }}"
                    style="display:inline;"
                    onsubmit="return confirm('この入庫を削除しますか？');">
                <button type="submit">削除</button>
              </form>
            </td>
            <td>
              <a class="btn" href="{{ url_for('transfer_new_from_purchase', purchase_id=p['purchase_id']) }}">
                店舗へ移動
              </a>
            </td>
          </tr>
        {% else %}
          <tr><td colspan="8">まだ入庫がありません。「入庫登録」から追加してください。</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}
