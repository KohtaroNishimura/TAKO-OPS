{% extends "base.html" %}
{% block content %}

<div class="card">
  <h2>週次棚卸（全材料）</h2>
  <div class="muted">
    週末の出汁/生地ロスなど、実在庫に合わせて調整します。保存すると差分が inventory_tx に ADJUST 反映されます。
  </div>

  <form method="post">
    <div class="row">
      <div>
        <label>棚卸日時</label>
        <input name="taken_at" value="{{ default_taken_at }}" placeholder="YYYY-MM-DD HH:MM:SS">
        <div class="muted">空なら現在時刻になります</div>
      </div>
      <div>
        <label>メモ</label>
        <input name="note" placeholder="例：週末ロス調整 / 棚卸など">
      </div>
    </div>

    <div class="card" style="margin-top:14px;">
      <table>
        <thead>
          <tr>
            <th>材料</th>
            <th>区分</th>
            <th>現在在庫</th>
            <th>棚卸数（counted_qty）</th>
            <th class="muted">単位</th>
          </tr>
        </thead>
        <tbody>
          {% for it in items %}
          <tr>
            <td>{{ it.name }}</td>
            <td><span class="pill">{{ it.cost_group }}</span></td>
            <td>{{ '%.3f'|format(it.current_qty) }}</td>
            <td style="width:220px;">
              <input
                type="number"
                step="0.001"
                name="counted_{{ it.item_id }}"
                value="{{ '%.3f'|format(it.current_qty) }}"
              >
            </td>
            <td class="muted">{{ it.unit_base }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <div class="actions">
        <button type="submit">保存して差分を反映</button>
        <a class="button-link" href="{{ url_for('stocktakes_list') }}">戻る</a>
      </div>
    </div>
  </form>
</div>

{% endblock %}
