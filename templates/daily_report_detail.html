{% extends "base.html" %}
{% block content %}
<div class="card rounded-2xl border border-slate-200 bg-white p-4 sm:p-6 shadow-sm">
  <h2 class="text-lg font-semibold text-slate-900">日報（{{ rep["report_date"] }}）</h2>

  <div class="my-3 flex flex-wrap gap-2">
    <a class="btn inline-flex items-center justify-center rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-slate-800 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400" href="{{ url_for('daily_reports_list') }}">日報一覧へ</a>
    <a class="btn inline-flex items-center justify-center rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-slate-800 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400" href="{{ url_for('daily_report_edit', daily_report_id=rep['daily_report_id']) }}">編集</a>
  </div>

  <h3 class="mt-4 text-base font-semibold text-slate-900">LINE送信用（コピペ用）</h3>

  <textarea id="lineText" rows="14" class="mt-2 w-full rounded-xl border border-slate-200 bg-slate-50 p-3 font-mono text-xs" readonly>{{ line_text }}</textarea>

  <div class="mt-3 flex flex-wrap items-center gap-2">
    <button class="btn inline-flex items-center justify-center rounded-xl bg-slate-900 px-4 py-2 text-sm font-semibold text-white shadow-sm hover:bg-slate-800 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-slate-400" type="button" onclick="copyLineText()">コピー</button>
    <span id="copyStatus" class="muted ml-2 text-sm text-slate-500"></span>
  </div>
</div>

<script>
async function copyLineText() {
  const el = document.getElementById("lineText");
  const status = document.getElementById("copyStatus");
  const text = el.value;

  // 1) まずは modern API
  try {
    await navigator.clipboard.writeText(text);
    status.textContent = "コピーしました！LINEに貼り付けて送れます。";
    return;
  } catch (e) {
    // 2) フォールバック（古い方式）
    el.focus();
    el.select();
    try {
      document.execCommand("copy");
      status.textContent = "コピーしました！LINEに貼り付けて送れます。";
    } catch (e2) {
      status.textContent = "コピーに失敗しました。テキストを手動で選択してコピーしてください。";
    }
  }
}
</script>
{% endblock %}
